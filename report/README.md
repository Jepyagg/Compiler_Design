## Project Assignment 1 - Lexical Definition report

### **學生 : 陳昱螢    學號 : 0616091**

## 作業內容：
* Write a scanner for the P language in lex

## 流程：
* 先根據要求將需要的切割的字串列出來：
    * Tokens That Will Be Passed to the Parser
        * Delimiters
        * Arithmetic, Relational, and Logical Operators
        * Keywords
        * Identifiers
        * Integer Constants
        * Floating-Point Constants
        * Scientific Notations
        * String Constants
    * Tokens That Will Be Discarded
        * Whitespace
        * C-style Comments
        * C++ style Comments
        * Pseudocomments
* 再依據所要切割的字串撰寫專用的```token```，這樣 scanner 才能 output 所要求的字串

## 作法：

* 我一開始先將 ```digital```, ```float```和```letter```的正則表達式先列出來：
    * Digital : ```[0-9]```
    * float : ```[a-zA-Z_]```
    * letter : ```(0|[1-9][0-9]*)\.(0|[0-9]*[1-9])```
* 這樣之後要寫正則表達式會比較方便一些。

* 之後我先將 ```Delimiters```, ```Arithmetic, Relational, and Logical Operators``` 以及 ```keyword```的 匹配規則先列出來，這部分是最簡單，因為基本上只要掃字串，然後讓token 輸出 對應的字串就行了

* 接著撰寫```Integer```和```OctInteger```的正則表達式，同時也將他們專用的 token macros 宣告在程式的第一段。

* 接著完成```id```, ```float``` 和 ```Scientific``` 的正則表達式，同時也將他們專用的 token macros 宣告在程式的第一段

* 接著將 C/C++ style 的 comments 給完成，C++ style比較簡單，只需要檢查```//```就行了，之後便將後面的都直接忽略即可。C style則比較麻煩一些，當讀到```/*```後，便脫離```INITIAL```進入到```C_COMMENT```，```C_COMMENT```分為兩種模式，一種是直接把字串忽略，另一種則是檢查有無遇到```*/```表示comment要結束，遇到的話便回到```INITIAL```

* 再來就將```Pseudocomments```完成，讀到```//&S+```便將```Opt_S```給1的值，```//&S-```的話則給0，```//&T+```以及```//&T-```則一樣，只是換成```Opt_T```而已

* 遇到 space 跟 tab 就直接忽略掉。

* ```\n```在一開始就寫好的，只需加上```<*>```來讓他不管在哪一個情況都能被執行，若沒加上的話，在```C_COMMENT```時，就不會被執行到，因此要加上```<*>```，來讓他可以被執行到。

* 最後就是完成 ```string``` 的部分，這部分也是比較麻煩的部分，因為要將前後的```"``` 劃分出來，然後在裡頭的```""```則要當作是```"```，因此在寫的時候想了蠻久的。先將搜尋```"字串"```的表達式寫出來，接著在開啟一個新的char來儲存新的字串，邊將切割出來的字串一個一個讀取，每次都檢查```當前的位置```以及```下一個位置```，是否都是```"```，若是的話，則直接將idx++，這樣就能忽略掉一個```"```，而只讓一個```"```被儲存到```新開的char```裡面。切割出來的字串都處理完後，再將```新開的char```最後面的值改成```\0```，因為原本會是```"```，而```string```不需要頭尾的```"```，最後再讓 token 從 ```char第一個idx```開始輸出，藉此移除掉最前面的```"```。

## 遇到的問題：

* 在寫```float``` 和 ```Scientific``` 的正則表達式時，遇上了不少的問題。像是因為```float```不能是0開頭跟0結尾，除非是```0.0```這種情況才行。一開始沒注意到有這個限制便將```float```的表達式寫成```[0-9]+\.[0-9]*```，結果測試的時候，便無法切割出```Oct```跟```float```會全都被當作```float```去輸出。之後便又重新撰寫成```[1-9][0-9]*\.[0-9]*```，結果會把0.開頭的給遺漏掉，所以又花不少時間才改成``` (0|[1-9][0-9]*)\.(0|[0-9]*[1-9]*)```，但這樣變成```.000```也會被接受，最終才改成正確的版本```(0|[1-9][0-9]*)\.(0|[0-9]*[1-9])```，算是花費大量的時間在處理```float```的表達式，float正常後， Scientific也變正常了！！！

* 寫C style 的comment時，因為一開始的規則寫錯，結果只要遇到```/*```後，就會直接將後方整行當作是註解，而沒去檢查有無```*/```的存在，因此一直輸出錯誤。
    * 花了不少時間檢查語法後，才發現不小心將```/*```的規則寫成：
        * ```"/*".* {LIST;BEGIN C_COMMENT;}```
    * 讓```/*```後面的字串都直接被忽略，而沒有檢查有無```*/```存在
    * 之後改成```"/*" {LIST;BEGIN C_COMMENT;}```後，功能就正常了!!!

* 寫 string 的時候花了不少的時間，一開始是頭尾的```"```都會被輸出，再來則是無法將字串內的```""```只輸出一個出來，因此做了不少的修改。
    * 要避免頭尾的```"```被輸出，因此在複製字串的時候，從index = 1開始，因為 index = 0 會是```"```的值，而在複製結束後，將最後一個改成```\0```來變成null，避開尾巴的```"```。
    * 為了讓```""```只輸出一個，所以就直接一個一個字去讀取並且複製到另外一個char 裡面，同時檢查下一個是不是也同樣是```"```，若有連續兩個則將 idx 加一 ，這樣就能少複製一個```"```到另外的char裡面去了。
